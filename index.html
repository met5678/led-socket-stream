<!doctype html>
<html>
<head>

	<!-- bower:css -->
	<link rel="stylesheet" href="bower_components/bootswatch-dist/css/bootstrap.css" />
	<!-- endbower -->
</head>
<body>

	<!-- bower:js -->
	<script src="bower_components/jquery/dist/jquery.js"></script>
	<script src="bower_components/bootswatch-dist/js/bootstrap.js"></script>
	<!-- endbower -->
	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io('http://192.168.1.115');

		var numLEDs = -1;
		var frameIndex = 0;

		var emitFrame = function() {
			var channels = numLEDs * 3;
			/*var brightness = frameIndex.toString(16);
			if(brightness.length == 1) {
				brightness = "0"+brightness;
			}
			var str = '';
			for(var a=0; a<channels; a++) {
				str += brightness;
			}*/

			var ab = new ArrayBuffer(channels);
			var buf = new Uint8ClampedArray(ab);
			for(var a=0; a<channels; a++) {
				if(a == frameIndex)
					buf[a] = 0xFF;
				else
					buf[a] = 0x00;
			}
			socket.emit('cf',ab);
			frameIndex = (frameIndex+1)%channels;
		};

		socket.on('config', function(data) {
			numLEDs = data.numLEDs;
			emitFrame();
			setInterval(emitFrame,20);
		});
	</script>
</body>
</html>
